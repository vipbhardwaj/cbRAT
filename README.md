# Table of Contents

1. [Description](#cbRAT)
2. [Features](#features)
3. [Prerequisites](#prerequisites)
4. [Test Coverage Provided by cbRAT](#Coverage)
5. [Getting Started](#Getting-Started)
   1. [Clone the Repository](#clone-the-repository)
   2. [Install Go and Verify Version](#install-go-and-verify-version)
   3. [Installing Deps](#Installing-deps)
   4. [Setup Cobra CLI](#setup-cobra-cli)
6. [Usage](#usage)

# cbRAT
cbRAT is a ***Go-based*** command-line tool designed and dedicated to automate the script generation part of the 
testing for v4 APIs, aka, the Management Public APIs for Capella and Columnar cloud database provided as products by 
Couchbase.
<br/><br/>
This tool is built using the Cobra library: `/spf13/cobra`, for creating powerful CLI applications.
<br/><br/>
The tool also leverages the following libraries for parsing YAML to JSON and unmarshalling data into the required 
format :
```
"getkin/kin-openapi/openapi3"
"gopkg.in/yaml.v2"
"encoding/json"
```

## Features
- Generates entire modules/directories consisting of one file per API endpoint. `cbModule`
- Each file consists of functions dedicated to the testing of that specific endpoint, which includes : 
  - Sensible test cases, which **belong to that specific API**, making sure stray/corrupted tests are not included.
  - Accurate expected errors **per test case**, depending on the factor that whether the test case being considered 
    is a negative test for that specific API.
  - Payload based tests for API endpoints that tinker with a resource, eg, `POST`, `PUT`, `PATCH`. Sometimes `GET` 
    as well if it carries a Payload with it (very rarely).
- Generation of individual API test files, as opposed to generating the entire directory, useful for cases when an 
  MP/single-customer-specific API endpoint is released, belonging to an already existing set of APIs for that 
  feature. `cbFile`
- Each test file will contain a fixed number of functions, all used for various types of API testing methods.
- The functions in the test files in-turn use underlying API call functions which can be generated by the 
  `cbSubmodule` command.
- `cbSubmodule` generate code for the repo that is used as a SubModule to the repository `TAF` for serving the API 
  calls being used by TAF.
- The generated files/modules have to be stored somewhere as well, taken care by `cbPaths`, which uses a `paths.cb` 
  file as a dedicated storage for directory paths for reads and writes for `cbRAT`'s code generation commands.

## Prerequisites
- Go 1.22.0 **ONLY**
  - go version `go1.22.0 darwin/arm64` recommended for Mac M-based chipset users
- That's it, yay! cbRAT is entirely based on Go, so no need for any other gibberish really. :wink:

## Coverage
- `test_api_path` : The script creates testcases which try to meddle with the URL path for a certain endpoint in 
  ways to exploit vulnerabilities.
- As these are negative test cases, the script also assigns `expected_errors` to the **junky URL paths** which 
  have an accuracy of ~90%
- `test_authorization` : Security tests, centered around the following metrics : 
  - 255 RBAC tests
  - 4 tests related to corrupted/expired/revoked access keys
  - 2 tests trying to access a resource via a access tokens related to another super-source that the underlying 
    resource doesn't belong to, with expected errors for the same as well to verify the correct behaviour.
- `test_query_parameters` : Testing all the possible params passed in the URL, **path + query**, with corrupted 
  values, to see the expected behaviours.
  - **NOTE**: Here the predictability of every new API/feature is highly un-deterministic, hence the accuracy of 
    `expected_error` generated per test is about ~65% and the rest is likely to be manually fixed in the script.
- `throttle_tests` : Considers of two functions, both of which throttle the server serving the API requests with a 
  current throttle rate of `150cpmpk` (Calls per Minute per Key), where keys can be : 
  - All that have access to the resource,
  - Some that do not have access to the resource.

## Getting Started
Follow these steps to set up and run cbRAT on your local machine.

### Clone the Repository
```bash
git clone https://github.com/vipbhardwaj/cbRAT.git
cd cbRAT
```

### Install Go and Verify Version
Ensure you have Go installed on your machine. If not, you can download and install it from 
[Go's official website](https://golang.org/dl/).

To verify the installed Go version, run:
```bash
go version
```

### Installing deps
```bash
go mod tidy
```

### Setup Cobra CLI
```bash
go build
```

## Usage
In general, any command can be executed using the `cbRAT` trigger before it in order for it to be recognized by cobra.
Example: 
```bash
cbRAT cbPaths --help
```
or 
```bash
cbRAT cbModule --help
```

The `--help` flag is associated with every command and lists out the **required and optional** flags for each 
command comprehensively.<br/><br/>
Even so, below the usage of certain commands has been described as examples : 
- cbModule
  ```bash
  cbRAT cbModule --user "User Name" --tag "Tag Related to the API feature" --nomenclature "Generalized Naming that would be used to name the Directory and Class" --superclass "The class name that has to be used as a superclass to the current tests"
  ```
- cbFile
  ```bash
  cbRAT cbFile --user "User Name" --superclass "Superclass name to the current file" --nomenclature "Name for the current class" --operationId "id linked to the specific API endpoint operation"
  ```
- cbPaths
  - To list the current read/write paths attached to cbRAT :
    ```bash
    cbRAT cbPaths
    ```
  - To mutate paths linked to each source/destination :
    ```bash
    cbRAT cbPaths --modulePath "Path for the Directory to be initialized" --readPath "Path to the openapi.generated.
    yaml file, from which the APIs are fetched" -- scriptDir "Path for cbFile, used for generating a single file and 
    placing it in the correct directory"
    ```
